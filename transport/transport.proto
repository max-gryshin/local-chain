syntax = "proto3";

import "google/protobuf/empty.proto";

service LocalChain {
  rpc AddPeer(AddPeerRequest) returns (AddPeerResponse) {}
  rpc RemovePeer(RemovePeerRequest) returns (RemovePeerResponse) {}
  rpc AddVoter(AddVoterRequest) returns (AddVoterResponse) {}
  rpc AddTransaction(AddTransactionRequest) returns (AddTransactionResponse) {}
  rpc GetBalance(GetBalanceRequest) returns (GetBalanceResponse) {}

  rpc AddUser(AddUserRequest) returns (AddUserResponse) {}
  rpc GetUser(GetUserRequest) returns (GetUserResponse) {}
  rpc ListUsers(google.protobuf.Empty) returns (ListUsersResponse) {}

  rpc GetBlockKeys(google.protobuf.Empty) returns (GetBlockKeysResponse) {}
  rpc GetBlock(GetBlockRequest) returns (GetBlockResponse) {}

  rpc GetTransaction(GetTransactionRequest) returns (GetTransactionResponse) {}
  rpc VerifyTransaction(VerifyTransactionRequest) returns (VerifyTransactionResponse) {}
}

message AddPeerRequest {
  string id = 1;
  string address = 2;
}

message AddPeerResponse {
  bool success = 1;
}

message RemovePeerRequest {
  string id = 1;
  string address = 2;
}

message RemovePeerResponse {
  bool success = 1;
}

message AddVoterRequest {
  string id = 1;
  string address = 2;
}

message AddVoterResponse {
  bool success = 1;
}

message AddTransactionRequest {
  bytes sender = 1;
  bytes receiver = 2;
  Amount amount = 3;
}

message GetBalanceRequest {
  bytes sender = 1;
}

message GetBalanceResponse {
    Amount amount = 1;
}

message AddTransactionResponse {
  Transaction transaction = 1;
}

message Amount {
  uint64 value = 1;
  uint32 unit = 2;
}

message Utxo {
  bytes txHash = 1;
  uint32 index = 2;
}

message AddUserRequest {
  User user = 1;
}

message GetUserRequest {
  string username = 1;
}

message ListUsersRequest {}

message AddUserResponse {
  bool success = 1;
}

message GetUserResponse {
  User user = 1;
}

message ListUsersResponse {
  repeated User users = 1;
}

message User {
  bytes publicKey = 1;
  bytes privateKey = 2;
  string username = 3;
}

message GetBlockRequest {
  uint64 timestamp = 1;
}

message GetBlockKeysResponse {
  repeated uint64 timestamp = 1;
}

message GetBlockResponse {
  repeated Block blocks = 1;
}

message Block {
  uint64 timestamp = 1;
  bytes previousHash = 2;
  bytes hash = 3;
}

message GetTransactionRequest {
  bytes id = 1;
}

message GetTransactionResponse {
  Transaction transaction = 1;
}

message Transaction {
  string id = 1;
  uint64 timestamp = 2;
  uint64 blockTimestamp = 3;
  bytes hash = 4;
  repeated Input inputs = 5;
  repeated Output outputs = 6;
}

message Input {
  bytes pubKey = 1;
  bytes signatureS = 2;
  bytes signatureR = 3;
}

message Output {
  bytes pubKey = 1;
  Amount amount = 2;
}

message VerifyTransactionRequest {
  bytes id = 1;
}

message VerifyTransactionResponse {
  bool isValid = 1;
  Transaction transaction = 2;
}